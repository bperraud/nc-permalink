{"version":3,"file":"permalink-settingsAdmin.mjs","sources":["../node_modules/vue-material-design-icons/AlertCircle.vue","../src/enums/SettingsKey.ts","../src/enums/UpdateState.ts","../src/mixins/SettingsMixin.ts","../src/components/AdminSettings.vue","../src/settings_admin.ts"],"sourcesContent":["<template>\n  <span v-bind=\"$attrs\"\n        :aria-hidden=\"title ? null : 'true'\"\n        :aria-label=\"title\"\n        class=\"material-design-icon alert-circle-icon\"\n        role=\"img\"\n        @click=\"$emit('click', $event)\">\n    <svg :fill=\"fillColor\"\n         class=\"material-design-icon__svg\"\n         :width=\"size\"\n         :height=\"size\"\n         viewBox=\"0 0 24 24\">\n      <path d=\"M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z\">\n        <title v-if=\"title\">{{ title }}</title>\n      </path>\n    </svg>\n  </span>\n</template>\n\n<script>\nexport default {\n  name: \"AlertCircleIcon\",\n  emits: ['click'],\n  props: {\n    title: {\n      type: String,\n    },\n    fillColor: {\n      type: String,\n      default: \"currentColor\"\n    },\n    size: {\n      type: Number,\n      default: 24\n    }\n  }\n}\n</script>","export enum SettingsKey {\n\tJwtSecretKey = 'jwt_secret_key',\n\tPermalinkApiEndpoint = 'permalink_api_endpoint'\n}\n","export enum UpdateState {\n\tIdle,\n\tUpdating,\n\tCompleted,\n\tError,\n}\n","import axios from '@nextcloud/axios'\nimport { generateUrl } from '@nextcloud/router'\nimport type { AppSettings } from '../interfaces/responses/AppSettings'\n\nexport default {\n    data() {\n        return {\n            settings: null,\n        }\n    },\n\n    methods: {\n        async fetchSettings(): Promise<void> {\n            try {\n                const response = await axios.get(\n                    generateUrl('/apps/permalink/settings'),\n                )\n                if (response.data) {\n                    this.settings = response.data\n                }\n            } catch (e) {\n                console.error(e.response)\n            }\n        },\n        async getSettings(): Promise<AppSettings | null> {\n            if (this.settings) {\n                return this.settings\n            } else {\n                await this.fetchSettings()\n                return this.settings\n            }\n        },\n        async getJwtSecret(): Promise<string> {\n            const settings = await this.getSettings()\n            return settings && settings.jwtSecretKey\n                ? settings.jwtSecretKey\n                : ''\n        },\n        async getPermalinkApiEndpoint(): Promise<string> {\n            const settings = await this.getSettings()\n            return settings && settings.permalinkApiEndpoint\n                ? settings.permalinkApiEndpoint\n                : ''\n        },\n    },\n}\n","<template>\n\t<div id=\"permalink-admin-settings\">\n\t\t<NcSettingsSection :name=\"t('permalink', 'API Endpoint')\"\n\t\t\t:description=\"t('permalink', 'Base URL of the external Permalink API that handles link creation')\">\n\t\t\t<div class=\"input-with-icon\">\n\t\t\t\t<h3>\n\t\t\t\t\t<span v-if=\"updating.key === SettingsKey.PermalinkApiEndpoint\"\n\t\t\t\t\t\tclass=\"status-icon\">\n\t\t\t\t\t\t<NcLoadingIcon v-if=\"updating.status === UpdateState.Updating\"\n\t\t\t\t\t\t\t:name=\"t('permalink', 'Saving...')\"\n\t\t\t\t\t\t\t:size=\"20\" />\n\t\t\t\t\t\t<CheckIcon v-else-if=\"updating.status === UpdateState.Completed\"\n\t\t\t\t\t\t\t:size=\"20\" />\n\t\t\t\t\t\t<AlertIcon v-else-if=\"updating.status === UpdateState.Error\"\n\t\t\t\t\t\t\t:size=\"20\" />\n\t\t\t\t\t</span>\n\t\t\t\t</h3>\n\t\t\t\t<NcSettingsInputText id=\"permalink-api-endpoint\"\n\t\t\t\t\tlabel=\"\"\n\t\t\t\t\t:value.sync=\"permalinkApiEndpoint\"\n\t\t\t\t\t:disabled=\"updating.status === UpdateState.Updating || loading\"\n\t\t\t\t\t@submit=\"onApiEndpointSubmit\" />\n\t\t\t</div>\n\t\t</NcSettingsSection>\n\t\t<NcSettingsSection :name=\"t('permalink', 'Jwt secret key')\"\n\t\t\t:description=\"t('permalink', 'Secret key used to sign JWT tokens for authenticating requests to the Permalink API. Must match the API\\'s configuration')\">\n\t\t\t<div class=\"input-with-icon\">\n\t\t\t\t<h3>\n\t\t\t\t\t<span v-if=\"updating.key === SettingsKey.JwtSecretKey\"\n\t\t\t\t\t\tclass=\"status-icon\">\n\t\t\t\t\t\t<NcLoadingIcon v-if=\"updating.status === UpdateState.Updating\"\n\t\t\t\t\t\t\t:name=\"t('permalink', 'Saving...')\"\n\t\t\t\t\t\t\t:size=\"20\" />\n\t\t\t\t\t\t<CheckIcon v-else-if=\"updating.status === UpdateState.Completed\"\n\t\t\t\t\t\t\t:size=\"20\" />\n\t\t\t\t\t\t<AlertIcon v-else-if=\"updating.status === UpdateState.Error\"\n\t\t\t\t\t\t\t:size=\"20\" />\n\t\t\t\t\t</span>\n\t\t\t\t</h3>\n\t\t\t\t<NcSettingsInputText id=\"jwt-secret-key\"\n\t\t\t\t\tlabel=\"\"\n\t\t\t\t\t:value.sync=\"jwtSecretKey\"\n\t\t\t\t\t:disabled=\"updating.status === UpdateState.Updating || loading\"\n\t\t\t\t\t@submit=\"onSecretKeySubmit\" />\n\t\t\t</div>\n\t\t</NcSettingsSection>\n\t</div>\n</template>\n\n<script lang=\"ts\">\n/* eslint-disable no-console */\nimport axios from '@nextcloud/axios'\nimport { showError } from '@nextcloud/dialogs'\nimport { t } from '@nextcloud/l10n'\nimport { generateUrl } from '@nextcloud/router'\nimport {\n    NcLoadingIcon,\n    NcSettingsInputText,\n    NcSettingsSection,\n    Tooltip,\n} from '@nextcloud/vue'\nimport AlertIcon from 'vue-material-design-icons/AlertCircle.vue'\n\nimport CheckIcon from 'vue-material-design-icons/Check.vue'\nimport { SettingsKey } from '../enums/SettingsKey.ts'\nimport { UpdateState } from '../enums/UpdateState.ts'\n\nimport SettingsMixin from '../mixins/SettingsMixin.ts'\n\nimport '@nextcloud/dialogs/style.css'\n\nexport default {\n    name: 'AdminSettings',\n\n    components: {\n        NcSettingsSection,\n        NcSettingsInputText,\n        NcLoadingIcon,\n        CheckIcon,\n        AlertIcon,\n    },\n\n    directives: {\n        Tooltip,\n    },\n\n    mixins: [SettingsMixin],\n\n    data() {\n        return {\n            updating: {\n                status: UpdateState.Idle,\n                key: null,\n            },\n            loading: true,\n            jwtSecretKey: '',\n            permalinkApiEndpoint: '',\n            deleteConflicts: false,\n        }\n    },\n\n    computed: {\n        UpdateState() {\n            return UpdateState\n        },\n        SettingsKey() {\n            return SettingsKey\n        },\n    },\n\n    async mounted() {\n        this.loading = true\n\n        this.jwtSecretKey = await this.getJwtSecret()\n        this.permalinkApiEndpoint = await this.getPermalinkApiEndpoint()\n\n        this.loading = false\n    },\n\n    methods: {\n        t,\n        setUpdate(key, status) {\n            this.updating.status = status\n            this.updating.key = key\n        },\n        async onSecretKeySubmit() {\n            await this.saveSettings(SettingsKey.JwtSecretKey, this.jwtSecretKey)\n        },\n        async onApiEndpointSubmit() {\n            await this.saveSettings(SettingsKey.PermalinkApiEndpoint, this.permalinkApiEndpoint)\n        },\n        async onDeleteConflictsChange(value) {\n            await this.saveSettings(\n                SettingsKey.DeleteRemovedShareConflicts,\n                value ? '1' : '0',\n            )\n        },\n        async saveSettings(key, value) {\n\n            const data = {\n                key,\n                value,\n            }\n\n            this.setUpdate(key, UpdateState.Updating)\n            try {\n                await axios.post(\n                    generateUrl('/apps/permalink/settings/save'),\n                    data,\n                )\n                this.setUpdate(key, UpdateState.Completed)\n            } catch (e) {\n                if (e.response.data && e.response.data.message) {\n                    showError(t('permalink', e.response.data.message))\n                } else {\n                    showError(\n                        t('permalink', 'Error occurred while saving settings'),\n                    )\n                    console.error(e.response)\n                }\n                this.setUpdate(key, UpdateState.Error)\n            }\n        },\n    },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.form-error {\n\tcolor: #c40c0c;\n\tdisplay: block;\n}\n\n.status-icon {\n\tmargin-left: 6px;\n}\n\n::v-deep(input#permalink-api-endpoint),\n::v-deep(input#jwt-secret-key) {\n\twidth: 300px !important;\n}\n\n.input-with-icon {\n\tdisplay: flex;\n\talign-items: center;\n\n\t.status-icon {\n\t\tmargin-bottom: 10px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t}\n}\n</style>\n","import Vue from 'vue'\nimport AdminSettings from './components/AdminSettings.vue'\n\nconsole.debug('Permalink: SettingsAdmin init')\n\nconst View = Vue.extend(AdminSettings)\nnew View().$mount('#permalink-admin-settings')\n"],"names":["_sfc_main","SettingsKey","UpdateState","axios","generateUrl","Tooltip","t"],"mappings":"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","x_google_ignoreList":[0]}