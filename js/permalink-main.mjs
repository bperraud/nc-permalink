(function(){"use strict";try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode(".btn[data-v-21737b32],.btn[data-v-07db8205]{margin-top:10px}.sharing-entry[data-v-07db8205]{display:flex;align-items:center;min-height:44px}.sharing-entry__summary[data-v-07db8205]{padding:8px;padding-inline-start:10px;display:flex;justify-content:space-between;flex:1 0;min-width:0}.sharing-entry__desc[data-v-07db8205]{display:flex;flex-direction:column;line-height:1.2em}.sharing-entry__desc p[data-v-07db8205]{color:var(--color-text-maxcontrast)}.sharing-entry__desc__title[data-v-07db8205]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.sharing-entry__actions[data-v-07db8205]{display:flex;align-items:center;margin-inline-start:auto}.sharing-entry:not(.sharing-entry--share) .sharing-entry__actions .new-share-link[data-v-07db8205]{border-top:1px solid var(--color-border)}.sharing-entry[data-v-07db8205] .avatar-link-share{background-color:var(--color-primary-element)}.sharing-entry .sharing-entry__action--public-upload[data-v-07db8205]{border-bottom:1px solid var(--color-border)}.sharing-entry__loading[data-v-07db8205]{width:44px;height:44px;margin:0;padding:14px;margin-inline-start:auto}.sharing-entry .action-item~.action-item[data-v-07db8205],.sharing-entry .action-item~.sharing-entry__loading[data-v-07db8205]{margin-inline-start:0}.sharing-entry .icon-checkmark-color[data-v-07db8205]{opacity:1;color:var(--color-success)}.qr-code-dialog[data-v-07db8205]{display:flex;width:100%;justify-content:center}.qr-code-dialog__img[data-v-07db8205]{width:100%;height:auto}.avatardiv[data-v-07db8205]{background-color:#c40c0c!important}.list-item__wrapper[data-v-07db8205]{position:relative;width:100%}.list-item-content__wrapper[data-v-07db8205]{padding-left:0}.list-item[data-v-07db8205]{display:block;position:relative;flex:0 0 auto;justify-content:flex-start;border-radius:32px;width:100%;transition:background-color var(--animation-quick) ease-in-out;list-style:none}.list-item-content__wrapper[data-v-07db8205]{display:flex;align-items:center}.list-item-content__wrapper--compact[data-v-07db8205]{height:36px}.list-item-content__wrapper--compact .line-one[data-v-07db8205],.list-item-content__wrapper--compact .line-two[data-v-07db8205]{margin-top:-4px;margin-bottom:-4px}.list-item-content[data-v-07db8205]{display:flex;flex:1 1 auto;justify-content:space-between}.list-item-content__main[data-v-07db8205]{flex:1 1 auto;width:0;margin-left:auto 0}.list-item-content__main--oneline[data-v-07db8205]{display:flex}.list-item-content__actions[data-v-07db8205]{flex:0 0 auto;align-self:center;justify-content:center;margin-left:4px}.list-item__extra[data-v-07db8205]{margin-top:4px}.line-one[data-v-07db8205]{margin-top:5px;display:flex;flex-direction:column;justify-content:center;white-space:nowrap;margin-left:10px;overflow:hidden}.line-one__title[data-v-07db8205]{overflow:hidden;flex-grow:1;text-overflow:ellipsis;color:var(--color-main-text);font-weight:400}.line-one__details[data-v-07db8205]{color:var(--color-text-maxcontrast);font-weight:400;max-width:200px;white-space:normal;overflow-wrap:break-word}.line-two[data-v-07db8205]{display:flex;align-items:flex-start;justify-content:space-between;white-space:nowrap}.line-two--bold[data-v-07db8205]{font-weight:700}.line-two__subtitle[data-v-07db8205]{overflow:hidden;flex-grow:1;white-space:nowrap;text-overflow:ellipsis;color:var(--color-text-maxcontrast)}.line-two__additional_elements[data-v-07db8205]{margin:2px 4px 0;display:flex;align-items:center}.line-two__indicator[data-v-07db8205]{margin:0 5px}.btn{margin-top:10px}.sharingTab__additionalContent{margin-top:4px!important}.sharingTab__additionalContent .sharing-entry__summary{padding-inline-start:0px!important}")),document.head.appendChild(t)}}catch(a){console.error("vite-plugin-css-injected-by-js",a)}})();
/*! third party licenses: js/vendor.LICENSE.txt */
import{n as l,c as u,_ as h,e as c,s as d,C as y,f as _,g as v,h as I,t as o,d as p}from"./style-8HsC40oc.chunk.mjs";const f={methods:{refreshSidebar(e){console.log("refreshSidebar");const i=OCA.Files.Sidebar.state.tabs.find(a=>a.id==="sharing");i?(i.update(e),console.log("Permalink: Updated share tab")):console.log("Permalink: No share tab to update")}}},b={mixins:[f],props:{permalink:{type:String,default:""},fileInfo:{type:Object,default:()=>{},required:!0}},computed:{fullFilePath(){return this.fileInfo?this.fileInfo.path.endsWith("/")?this.fileInfo.path+this.fileInfo.name:this.fileInfo.path+"/"+this.fileInfo.name:""}},methods:{async createPermalink(){const e={path:this.fullFilePath};try{const i=await u.post(h("apps/permalink/api/link"),e);console.log("Response:",i),c(t("permalink","Permalink created")),this.refreshSidebar(this.fileInfo),this.$emit("refresh")}catch(i){d(t("permalink","Error creating permalink")),i.response&&i.response.data&&i.response.data.message?console.error(i.response.data):console.error(i)}}}};var L=function(){var e=this,i=e._self._c;return i("div",[i("button",{staticClass:"btn btn-primary",on:{click:function(a){return a.preventDefault(),e.createPermalink.apply(null,arguments)}}},[e._v(" "+e._s(e.permalink)+" ")])])},S=[],w=l(b,L,S,!1,null,"21737b32");const A=w.exports,P={name:"LinkVariantIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var x=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon link-variant-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(a){return e.$emit("click",a)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M10.59,13.41C11,13.8 11,14.44 10.59,14.83C10.2,15.22 9.56,15.22 9.17,14.83C7.22,12.88 7.22,9.71 9.17,7.76V7.76L12.71,4.22C14.66,2.27 17.83,2.27 19.78,4.22C21.73,6.17 21.73,9.34 19.78,11.29L18.29,12.78C18.3,11.96 18.17,11.14 17.89,10.36L18.36,9.88C19.54,8.71 19.54,6.81 18.36,5.64C17.19,4.46 15.29,4.46 14.12,5.64L10.59,9.17C9.41,10.34 9.41,12.24 10.59,13.41M13.41,9.17C13.8,8.78 14.44,8.78 14.83,9.17C16.78,11.12 16.78,14.29 14.83,16.24V16.24L11.29,19.78C9.34,21.73 6.17,21.73 4.22,19.78C2.27,17.83 2.27,14.66 4.22,12.71L5.71,11.22C5.7,12.04 5.83,12.86 6.11,13.65L5.64,14.12C4.46,15.29 4.46,17.19 5.64,18.36C6.81,19.54 8.71,19.54 9.88,18.36L13.41,14.83C14.59,13.66 14.59,11.76 13.41,10.59C13,10.2 13,9.56 13.41,9.17Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},$=[],B=l(P,x,$,!1,null,null);const z=B.exports,V={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var N=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon close-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(a){return e.$emit("click",a)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},T=[],O=l(V,N,T,!1,null,null);const D=O.exports,H={name:"ContentCopyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var M=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon content-copy-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(a){return e.$emit("click",a)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},F=[],R=l(H,M,F,!1,null,null);const E=R.exports,j={components:{NcAvatar:I,NcActions:v,NcActionButton:_,CheckIcon:y,ClipboardIcon:E,CloseIcon:D,LinkVariantIcon:z},mixins:[f],props:{permalink:{type:String,default:""},fileInfo:{type:Object,default:()=>{},required:!0}},data(){return{copySuccess:!0,copied:!1}},methods:{fullFilePath(){return this.fileInfo?this.fileInfo.path.endsWith("/")?this.fileInfo.path+this.fileInfo.name:this.fileInfo.path+"/"+this.fileInfo.name:""},async copyLink(){try{console.log("Copied permalink : ",this.permalink),await navigator.clipboard.writeText(this.permalink),c(o("permalink","Link copied")),this.$refs.copyButton.$el.focus(),this.copySuccess=!0,this.copied=!0}catch(e){this.copySuccess=!1,this.copied=!0,console.error(e)}finally{setTimeout(()=>{this.copySuccess=!1,this.copied=!1},4e3)}},async onDelete(){const e=encodeURIComponent(this.fullFilePath());console.log("onDelete with link",e);try{const i=await u.delete(h("apps/permalink/api/link")+`?path=${e}`);console.log("Response:",i),c(o("permalink","Permalink deleted")),this.refreshSidebar(this.fileInfo),this.$emit("refresh")}catch(i){i.response&&i.response.data&&i.response.data.message?console.error(i.response.data):console.error(i)}},copyLinkTooltip(){return this.copied?this.copySuccess?"":o("permalink","Cannot copy, please copy the link manually"):o("permalink","Copy permalink to clipboard")},actionsTooltip(){return o("permalink","Actions for permalink")}}};var q=function(){var e=this,i=e._self._c;return i("li",{staticClass:"sharing-entry sharing-entry__link"},[i("div",{staticClass:"sharing-entry__summary"},[i("div",{staticClass:"sharing-entry__desc"},[i("div",{staticClass:"list-item-content__wrapper"},[i("div",{staticClass:"list-item-content"},[i("NcAvatar",{attrs:{"is-no-user":!0,"icon-class":"avatardiv",title:"Permalink"},scopedSlots:e._u([{key:"icon",fn:function(){return[i("LinkVariantIcon",{attrs:{"fill-color":"white",size:18}})]},proxy:!0}])}),e._m(0)],1)])]),i("div",{staticClass:"sharing-entry__actions"},[i("NcActions",{ref:"copyButton",staticClass:"sharing-entry__copy"},[i("NcActionButton",{attrs:{"aria-label":e.copyLinkTooltip(),title:e.copyLinkTooltip(),href:e.permalink},on:{click:function(a){return a.preventDefault(),e.copyLink.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.copied&&e.copySuccess?i("CheckIcon",{staticClass:"icon-checkmark-color",attrs:{size:20}}):i("ClipboardIcon",{attrs:{size:20}})]},proxy:!0}])})],1)],1)]),i("NcActions",{staticClass:"sharing-entry__actions",attrs:{"aria-label":e.t("permalink","Actions for permalink"),"menu-align":"right"}},[i("NcActionButton",{on:{click:function(a){return a.preventDefault(),e.onDelete.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[i("CloseIcon",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("permalink","Delete permalink"))+" ")])],1)],1)},U=[function(){var e=this,i=e._self._c;return i("div",{staticClass:"line-one"},[i("span",{staticClass:"line-one__title"},[e._v(" Lien de partage permanent ")])])}],W=l(j,q,U,!1,null,"07db8205");const Z=W.exports,G={components:{CreateButton:A,PermalinkVue:Z},mixins:[f],props:{fileInfo:{type:Object,required:!0}},data(){return{activeButtonComponent:null,permalink:""}},mounted(){this.getPermalink()},methods:{fullFilePath(){return this.fileInfo?this.fileInfo.path.endsWith("/")?this.fileInfo.path+this.fileInfo.name:this.fileInfo.path+"/"+this.fileInfo.name:""},async getPermalink(){const e=encodeURIComponent(this.fullFilePath());try{const i=await u.get(h("apps/permalink/api/link")+`?path=${e}`);if(console.log("Response:",i),[200,100,400].includes(i.data.ocs.meta.statuscode))i.data.ocs.data.permalink?(this.permalink=i.data.ocs.data.permalink,this.activeButtonComponent="PermalinkVue"):(this.permalink=o("files_sharing","Create Permalink"),this.activeButtonComponent="CreateButton");else{const a=i.data.ocs.data.message?i.data.ocs.data.message:i.data.ocs.data.detail;d(o("permalink","Permalink: "+a))}}catch(i){i.response&&i.response.data&&i.response.data.message?console.error(i.response.data):console.error(i)}}}};var J=function(){var e=this,i=e._self._c;return i("div",[i(e.activeButtonComponent,{tag:"component",attrs:{"file-info":e.fileInfo,permalink:e.permalink},on:{refresh:e.getPermalink}})],1)},K=[],Q=l(G,J,K,!1,null,null);const X=Q.exports;p.prototype.OCA=window.OCA,p.mixin({methods:{t,n}});let s=null;const Y=p.extend(X);function ee(e,i=2e3,a=50){return new Promise((k,C)=>{let g=0;const m=()=>{const r=e();r&&r.length>0&&r[0]instanceof HTMLElement?k(r[0]):(g+=a)>=i?C(new Error("Timeout: el[0] not available")):setTimeout(m,a)};m()})}window.addEventListener("DOMContentLoaded",function(){OCA.Sharing&&OCA.Sharing.ShareTabSections&&OCA.Sharing.ShareTabSections.registerSection((e,i)=>{ee(()=>e).then(a=>{e=a,!(!e||!i)&&(s&&(s.$destroy(),s.$el.remove(),s=null),s=new Y({propsData:{fileInfo:i}}),s.$mount(),e.appendChild(s.$el))}).catch(a=>{console.warn("Could not find valid mount element:",a)})})});
//# sourceMappingURL=permalink-main.mjs.map
