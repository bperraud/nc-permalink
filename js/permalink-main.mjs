(function(){"use strict";try{if(typeof document<"u"){var a=document.createElement("style");a.appendChild(document.createTextNode(".btn[data-v-21737b32],.btn[data-v-8d91a2a5]{margin-top:10px}.sharing-entry[data-v-8d91a2a5]{display:flex;align-items:center;min-height:44px}.sharing-entry__summary[data-v-8d91a2a5]{padding:8px;padding-inline-start:10px;display:flex;justify-content:space-between;flex:1 0;min-width:0}.sharing-entry__desc[data-v-8d91a2a5]{display:flex;flex-direction:column;line-height:1.2em}.sharing-entry__desc p[data-v-8d91a2a5]{color:var(--color-text-maxcontrast)}.sharing-entry__desc__title[data-v-8d91a2a5]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.sharing-entry__actions[data-v-8d91a2a5]{display:flex;align-items:center;margin-inline-start:auto}.sharing-entry:not(.sharing-entry--share) .sharing-entry__actions .new-share-link[data-v-8d91a2a5]{border-top:1px solid var(--color-border)}.sharing-entry[data-v-8d91a2a5] .avatar-link-share{background-color:var(--color-primary-element)}.sharing-entry .sharing-entry__action--public-upload[data-v-8d91a2a5]{border-bottom:1px solid var(--color-border)}.sharing-entry__loading[data-v-8d91a2a5]{width:44px;height:44px;margin:0;padding:14px;margin-inline-start:auto}.sharing-entry .action-item~.action-item[data-v-8d91a2a5],.sharing-entry .action-item~.sharing-entry__loading[data-v-8d91a2a5]{margin-inline-start:0}.sharing-entry .icon-checkmark-color[data-v-8d91a2a5]{opacity:1;color:var(--color-success)}.qr-code-dialog[data-v-8d91a2a5]{display:flex;width:100%;justify-content:center}.qr-code-dialog__img[data-v-8d91a2a5]{width:100%;height:auto}.btn{margin-top:10px}.sharingTab__additionalContent{margin:4px!important}")),document.head.appendChild(a)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
/*! third party licenses: js/vendor.LICENSE.txt */
import{aE as r,f as p,_ as h,aJ as l,aI as u,aH as m,J as d,F as k,aF as o,V as c}from"./style-Bg3yeD8g.chunk.mjs";const f={methods:{refreshSidebar(e){console.log("refreshSidebar");const i=OCA.Files.Sidebar.state.tabs.find(a=>a.id==="sharing");i?(i.update(e),console.log("Permalink: Updated share tab")):console.log("Permalink: No share tab to update")}}},y={mixins:[f],props:{permalink:{type:String,default:""},fileInfo:{type:Object,default:()=>{},required:!0}},computed:{fullFilePath(){return this.fileInfo?this.fileInfo.path.endsWith("/")?this.fileInfo.path+this.fileInfo.name:this.fileInfo.path+"/"+this.fileInfo.name:""}},methods:{async createPermalink(){const e={path:this.fullFilePath};try{const i=await p.post(h("apps/permalink/api/link"),e);console.log("Response:",i),l(t("permalink","Permalink created")),this.refreshSidebar(this.fileInfo),this.$emit("refresh")}catch(i){u(t("permalink","Error creating permalink")),i.response&&i.response.data&&i.response.data.message?console.error(i.response.data):console.error(i)}}}};var g=function(){var e=this,i=e._self._c;return i("div",[i("button",{staticClass:"btn btn-primary",on:{click:function(a){return a.preventDefault(),e.createPermalink.apply(null,arguments)}}},[e._v(" "+e._s(e.permalink)+" ")])])},C=[],_=r(y,g,C,!1,null,"21737b32");const v=_.exports,I={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var b=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon close-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(a){return e.$emit("click",a)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},S=[],L=r(I,b,S,!1,null,null);const A=L.exports,P={name:"ContentCopyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var w=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon content-copy-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(a){return e.$emit("click",a)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},x=[],$=r(P,w,x,!1,null,null);const B=$.exports,O={components:{NcActions:k,NcActionButton:d,CheckIcon:m,ClipboardIcon:B,CloseIcon:A},mixins:[f],props:{permalink:{type:String,default:""},fileInfo:{type:Object,default:()=>{},required:!0}},data(){return{copySuccess:!0,copied:!1}},methods:{fullFilePath(){return this.fileInfo?this.fileInfo.path.endsWith("/")?this.fileInfo.path+this.fileInfo.name:this.fileInfo.path+"/"+this.fileInfo.name:""},async copyLink(){try{console.log("Copied permalink : ",this.permalink),await navigator.clipboard.writeText(this.permalink),l(o("permalink","Link copied")),this.$refs.copyButton.$el.focus(),this.copySuccess=!0,this.copied=!0}catch(e){this.copySuccess=!1,this.copied=!0,console.error(e)}finally{setTimeout(()=>{this.copySuccess=!1,this.copied=!1},4e3)}},async onDelete(){const e=encodeURIComponent(this.fullFilePath());console.log("onDelete with link",e);try{const i=await p.delete(h("apps/permalink/api/link")+`?path=${e}`);console.log("Response:",i),l(o("permalink","Permalink deleted")),this.refreshSidebar(this.fileInfo),this.$emit("refresh")}catch(i){i.response&&i.response.data&&i.response.data.message?console.error(i.response.data):console.error(i)}},copyLinkTooltip(){return this.copied?this.copySuccess?"":o("permalink","Cannot copy, please copy the link manually"):o("permalink","Copy permalink to clipboard")},actionsTooltip(){return o("permalink","Actions for permalink")}}};var z=function(){var e=this,i=e._self._c;return i("li",{staticClass:"sharing-entry sharing-entry__link"},[i("div",{staticClass:"sharing-entry__summary"},[i("div",{staticClass:"sharing-entry__desc"},[i("p",[e._v(" "+e._s(e.permalink)+" ")])]),i("div",{staticClass:"sharing-entry__actions"},[i("NcActions",{ref:"copyButton",staticClass:"sharing-entry__copy"},[i("NcActionButton",{attrs:{"aria-label":e.copyLinkTooltip(),title:e.copyLinkTooltip(),href:e.permalink},on:{click:function(a){return a.preventDefault(),e.copyLink.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.copied&&e.copySuccess?i("CheckIcon",{staticClass:"icon-checkmark-color",attrs:{size:20}}):i("ClipboardIcon",{attrs:{size:20}})]},proxy:!0}])})],1)],1)]),i("NcActions",{staticClass:"sharing-entry__actions",attrs:{"aria-label":e.t("permalink","Actions for permalink"),"menu-align":"right"}},[i("NcActionButton",{on:{click:function(a){return a.preventDefault(),e.onDelete.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[i("CloseIcon",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("permalink","Delete permalink"))+" ")])],1)],1)},D=[],F=r(O,z,D,!1,null,"8d91a2a5");const N=F.exports,V={components:{CreateButton:v,PermalinkVue:N},mixins:[f],props:{fileInfo:{type:Object,required:!0}},data(){return{activeButtonComponent:null,permalink:""}},mounted(){this.getPermalink()},methods:{fullFilePath(){return this.fileInfo?this.fileInfo.path.endsWith("/")?this.fileInfo.path+this.fileInfo.name:this.fileInfo.path+"/"+this.fileInfo.name:""},async getPermalink(){const e=encodeURIComponent(this.fullFilePath());try{const i=await p.get(h("apps/permalink/api/link")+`?path=${e}`);if(console.log("Response:",i),[200,100,400].includes(i.data.ocs.meta.statuscode))i.data.ocs.data.permalink?(this.permalink=i.data.ocs.data.permalink,this.activeButtonComponent="PermalinkVue"):(this.permalink=o("files_sharing","Create Permalink"),this.activeButtonComponent="CreateButton");else{const a=i.data.ocs.data.message?i.data.ocs.data.message:i.data.ocs.data.detail;u(o("permalink","Permalink: "+a))}}catch(i){i.response&&i.response.data&&i.response.data.message?console.error(i.response.data):console.error(i)}}}};var H=function(){var e=this,i=e._self._c;return i("div",[i(e.activeButtonComponent,{tag:"component",attrs:{"file-info":e.fileInfo,permalink:e.permalink},on:{refresh:e.getPermalink}})],1)},T=[],M=r(V,H,T,!1,null,null);const R=M.exports;c.prototype.OCA=window.OCA,c.mixin({methods:{t,n}});let s=null;const j=c.extend(R);window.addEventListener("DOMContentLoaded",function(){OCA.Sharing&&OCA.Sharing.ShareTabSections&&OCA.Sharing.ShareTabSections.registerSection((e,i)=>{!e||!i||(s&&(s.$destroy(),s.$el.remove(),s=null),s=new j({propsData:{fileInfo:i}}),s.$mount(),e[0].appendChild(s.$el))})});
//# sourceMappingURL=permalink-main.mjs.map
