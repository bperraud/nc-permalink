(function(){"use strict";try{if(typeof document<"u"){var a=document.createElement("style");a.appendChild(document.createTextNode(".btn[data-v-21737b32],.btn[data-v-3a20db04]{margin-top:10px}.sharing-entry[data-v-3a20db04]{display:flex;align-items:center;min-height:44px}.sharing-entry__summary[data-v-3a20db04]{padding:8px;padding-inline-start:10px;display:flex;justify-content:space-between;flex:1 0;min-width:0}.sharing-entry__desc[data-v-3a20db04]{display:flex;flex-direction:column;line-height:1.2em}.sharing-entry__desc p[data-v-3a20db04]{color:var(--color-text-maxcontrast)}.sharing-entry__desc__title[data-v-3a20db04]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.sharing-entry__actions[data-v-3a20db04]{display:flex;align-items:center;margin-inline-start:auto}.sharing-entry:not(.sharing-entry--share) .sharing-entry__actions .new-share-link[data-v-3a20db04]{border-top:1px solid var(--color-border)}.sharing-entry[data-v-3a20db04] .avatar-link-share{background-color:var(--color-primary-element)}.sharing-entry .sharing-entry__action--public-upload[data-v-3a20db04]{border-bottom:1px solid var(--color-border)}.sharing-entry__loading[data-v-3a20db04]{width:44px;height:44px;margin:0;padding:14px;margin-inline-start:auto}.sharing-entry .action-item~.action-item[data-v-3a20db04],.sharing-entry .action-item~.sharing-entry__loading[data-v-3a20db04]{margin-inline-start:0}.sharing-entry .icon-checkmark-color[data-v-3a20db04]{opacity:1;color:var(--color-success)}.qr-code-dialog[data-v-3a20db04]{display:flex;width:100%;justify-content:center}.qr-code-dialog__img[data-v-3a20db04]{width:100%;height:auto}.btn[data-v-4095583d]{margin-top:10px}")),document.head.appendChild(a)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
/*! third party licenses: js/vendor.LICENSE.txt */
import{aE as r,f as h,_ as f,aI as p,aH as k,J as g,F as y,aF as o,V as c}from"./style-BLQ1ypJP.chunk.mjs";const u={methods:{refreshSidebar(e){const i=OCA.Files.Sidebar.state.tabs.find(s=>s.id==="sharing");i?(i.update(e),console.debug("Permalink: Updated share tab")):console.debug("Permalink: No share tab to update")}}},_={mixins:[u],props:{permalink:{type:String,default:""},fileInfo:{type:Object,default:()=>{},required:!0}},computed:{fullFilePath(){return this.fileInfo?this.fileInfo.path.endsWith("/")?this.fileInfo.path+this.fileInfo.name:this.fileInfo.path+"/"+this.fileInfo.name:""}},methods:{async createPermalink(){const e={path:this.fullFilePath};try{const i=await h.post(f("apps/permalink/api/link"),e);console.log("Response:",i),p(t("permalink","Permalink created")),this.refreshSidebar(this.fileInfo),this.$emit("refresh")}catch(i){k(t("permalink","Error creating permalink")),i.response&&i.response.data&&i.response.data.message?console.error(i.response.data):console.error(i)}}}};var C=function(){var e=this,i=e._self._c;return i("div",[i("button",{staticClass:"btn btn-primary",on:{click:function(s){return s.preventDefault(),e.createPermalink.apply(null,arguments)}}},[e._v(" "+e._s(e.permalink)+" ")])])},v=[],I=r(_,C,v,!1,null,"21737b32");const m=I.exports,b={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var S=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon close-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(s){return e.$emit("click",s)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},L=[],A=r(b,S,L,!1,null,null);const w=A.exports,x={name:"CheckBoldIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var P=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon check-bold-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(s){return e.$emit("click",s)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},B=[],$=r(x,P,B,!1,null,null);const z=$.exports,N={name:"ContentCopyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var O=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon content-copy-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(s){return e.$emit("click",s)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},F=[],D=r(N,O,F,!1,null,null);const H=D.exports,T={components:{NcActions:y,NcActionButton:g,CheckIcon:z,ClipboardIcon:H,CloseIcon:w},mixins:[u],props:{permalink:{type:String,default:""},fileInfo:{type:Object,default:()=>{},required:!0}},data(){return{copySuccess:!0,copied:!1}},methods:{fullFilePath(){return this.fileInfo?this.fileInfo.path.endsWith("/")?this.fileInfo.path+this.fileInfo.name:this.fileInfo.path+"/"+this.fileInfo.name:""},async copyLink(){try{console.log("Copied permalink : ",this.permalink),await navigator.clipboard.writeText(this.permalink),p(o("permalink","Link copied")),this.$refs.copyButton.$el.focus(),this.copySuccess=!0,this.copied=!0}catch(e){this.copySuccess=!1,this.copied=!0,console.error(e)}finally{setTimeout(()=>{this.copySuccess=!1,this.copied=!1},4e3)}},async onDelete(){const e=encodeURIComponent(this.fullFilePath());console.log("onDelete with link",e);try{const i=await h.delete(f("apps/permalink/api/link")+`?path=${e}`);console.log("Response:",i),p(o("permalink","Permalink deleted")),this.refreshSidebar(this.fileInfo),this.$emit("refresh")}catch(i){i.response&&i.response.data&&i.response.data.message?console.error(i.response.data):console.error(i)}},copyLinkTooltip(){return this.copied?this.copySuccess?"":o("permalink","Cannot copy, please copy the link manually"):o("permalink","Copy permalink to clipboard")},actionsTooltip(){return o("permalink","Actions for permalink")}}};var V=function(){var e=this,i=e._self._c;return i("li",{staticClass:"sharing-entry sharing-entry__link"},[i("div",{staticClass:"sharing-entry__summary"},[i("div",{staticClass:"sharing-entry__desc"},[i("p",[e._v(" "+e._s(e.permalink)+" ")])]),i("div",{staticClass:"sharing-entry__actions"},[i("NcActions",{ref:"copyButton",staticClass:"sharing-entry__copy"},[i("NcActionButton",{attrs:{"aria-label":e.copyLinkTooltip(),title:e.copyLinkTooltip(),href:e.permalink},on:{click:function(s){return s.preventDefault(),e.copyLink.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.copied&&e.copySuccess?i("CheckIcon",{staticClass:"icon-checkmark-color",attrs:{size:20}}):i("ClipboardIcon",{attrs:{size:20}})]},proxy:!0}])})],1)],1)]),i("NcActions",{staticClass:"sharing-entry__actions",attrs:{"aria-label":e.t("permalink","Actions for permalink"),"menu-align":"right"}},[i("NcActionButton",{on:{click:function(s){return s.preventDefault(),e.onDelete.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[i("CloseIcon",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("permalink","Delete permalink"))+" ")])],1)],1)},M=[],R=r(T,V,M,!1,null,"3a20db04");const d=R.exports,j={components:{CreateButton:m,PermalinkVue:d},mixins:[u],props:{fileInfo:{type:Object,required:!0}},data(){return{activeButtonComponent:null,permalink:""}},mounted(){this.getPermalink(),this.refreshSidebar(this.fileInfo)},methods:{fullFilePath(){return this.fileInfo?this.fileInfo.path.endsWith("/")?this.fileInfo.path+this.fileInfo.name:this.fileInfo.path+"/"+this.fileInfo.name:""},async getPermalink(){const e=encodeURIComponent(this.fullFilePath());try{const i=await h.get(f("apps/permalink/api/link")+`?path=${e}`);console.log("Response:",i),i.data.ocs.data.permalink?(this.permalink=i.data.ocs.data.permalink,this.activeButtonComponent=d):(this.permalink=o("files_sharing","Create Permalink"),this.activeButtonComponent=m)}catch(i){i.response&&i.response.data&&i.response.data.message?console.error(i.response.data):console.error(i)}}}};var q=function(){var e=this,i=e._self._c;return i("div",[e.activeButtonComponent?i(e.activeButtonComponent,{tag:"component",attrs:{"file-info":e.fileInfo,permalink:e.permalink},on:{refresh:e.getPermalink}}):e._e()],1)},E=[],U=r(j,q,E,!1,null,"4095583d");const W=U.exports;c.prototype.OCA=window.OCA,c.mixin({methods:{t,n}});let a=null,l=null;const Z=c.extend(W);window.addEventListener("DOMContentLoaded",function(){OCA.Sharing&&OCA.Sharing.ShareTabSections&&OCA.Sharing.ShareTabSections.registerSection((e,i)=>{!e||!i||(a&&document.contains(a.$el)&&l?l.fileInfo=i:(a&&a.$destroy(),a=new Z({props:{fileInfo:i}}),l=c.observable({...a._props,fileInfo:i}),a._props=l,a.$mount(e[0])))})});
//# sourceMappingURL=permalink-main.mjs.map
