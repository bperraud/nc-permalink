(function(){"use strict";try{if(typeof document<"u"){var a=document.createElement("style");a.appendChild(document.createTextNode(".btn[data-v-f5d553ba],.btn[data-v-12b5e78f]{margin-top:10px}.sharing-entry[data-v-12b5e78f]{display:flex;align-items:center;min-height:44px}.sharing-entry__summary[data-v-12b5e78f]{padding:8px;padding-inline-start:10px;display:flex;justify-content:space-between;flex:1 0;min-width:0}.sharing-entry__desc[data-v-12b5e78f]{display:flex;flex-direction:column;line-height:1.2em}.sharing-entry__desc p[data-v-12b5e78f]{color:var(--color-text-maxcontrast)}.sharing-entry__desc__title[data-v-12b5e78f]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.sharing-entry__actions[data-v-12b5e78f]{display:flex;align-items:center;margin-inline-start:auto}.sharing-entry:not(.sharing-entry--share) .sharing-entry__actions .new-share-link[data-v-12b5e78f]{border-top:1px solid var(--color-border)}.sharing-entry[data-v-12b5e78f] .avatar-link-share{background-color:var(--color-primary-element)}.sharing-entry .sharing-entry__action--public-upload[data-v-12b5e78f]{border-bottom:1px solid var(--color-border)}.sharing-entry__loading[data-v-12b5e78f]{width:44px;height:44px;margin:0;padding:14px;margin-inline-start:auto}.sharing-entry .action-item~.action-item[data-v-12b5e78f],.sharing-entry .action-item~.sharing-entry__loading[data-v-12b5e78f]{margin-inline-start:0}.sharing-entry .icon-checkmark-color[data-v-12b5e78f]{opacity:1;color:var(--color-success)}.qr-code-dialog[data-v-12b5e78f]{display:flex;width:100%;justify-content:center}.qr-code-dialog__img[data-v-12b5e78f]{width:100%;height:auto}.btn[data-v-dccaaa25]{margin-top:10px}")),document.head.appendChild(a)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();
/*! third party licenses: js/vendor.LICENSE.txt */
import{aE as r,f as h,aI as p,aH as d,J as k,F as g,aF as o,V as c}from"./style-BLQ1ypJP.chunk.mjs";const f={methods:{refreshSidebar(e){const i=OCA.Files.Sidebar.state.tabs.find(s=>s.id==="sharing");i?(i.update(e),console.debug("Permalink: Updated share tab")):console.debug("Permalink: No share tab to update")}}},y={mixins:[f],props:{permalink:{type:String,default:""},fileInfo:{type:Object,default:()=>{},required:!0}},computed:{fullFilePath(){return this.fileInfo?this.fileInfo.path.endsWith("/")?this.fileInfo.path+this.fileInfo.name:this.fileInfo.path+"/"+this.fileInfo.name:""}},methods:{async createPermalink(){const e={path:this.fullFilePath};try{const i=await h.post("/ocs/v2.php/apps/permalink/api/link",e);console.log("Response:",i),p(t("permalink","Permalink created")),this.refreshSidebar(this.fileInfo),this.$emit("refresh")}catch(i){d(t("permalink","Error creating permalink")),i.response&&i.response.data&&i.response.data.message?console.error(i.response.data):console.error(i)}}}};var _=function(){var e=this,i=e._self._c;return i("div",[i("button",{staticClass:"btn btn-primary",on:{click:function(s){return s.preventDefault(),e.createPermalink.apply(null,arguments)}}},[e._v(" "+e._s(e.permalink)+" ")])])},C=[],v=r(y,_,C,!1,null,"f5d553ba");const u=v.exports,I={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var b=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon close-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(s){return e.$emit("click",s)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},S=[],L=r(I,b,S,!1,null,null);const A=L.exports,w={name:"CheckBoldIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var x=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon check-bold-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(s){return e.$emit("click",s)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},P=[],B=r(w,x,P,!1,null,null);const $=B.exports,z={name:"ContentCopyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var N=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon content-copy-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(s){return e.$emit("click",s)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},O=[],F=r(z,N,O,!1,null,null);const D=F.exports,H={components:{NcActions:g,NcActionButton:k,CheckIcon:$,ClipboardIcon:D,CloseIcon:A},mixins:[f],props:{permalink:{type:String,default:""},fileInfo:{type:Object,default:()=>{},required:!0}},data(){return{copySuccess:!0,copied:!1}},methods:{fullFilePath(){return this.fileInfo?this.fileInfo.path.endsWith("/")?this.fileInfo.path+this.fileInfo.name:this.fileInfo.path+"/"+this.fileInfo.name:""},async copyLink(){try{console.log("Copied permalink : ",this.permalink),await navigator.clipboard.writeText(this.permalink),p(o("permalink","Link copied")),this.$refs.copyButton.$el.focus(),this.copySuccess=!0,this.copied=!0}catch(e){this.copySuccess=!1,this.copied=!0,console.error(e)}finally{setTimeout(()=>{this.copySuccess=!1,this.copied=!1},4e3)}},async onDelete(){const e=encodeURIComponent(this.fullFilePath());console.log("onDelete with link",e);try{const i=await h.delete(`/ocs/v2.php/apps/permalink/api/link?path=${e}`);console.log("Response:",i),p(o("permalink","Permalink deleted")),this.refreshSidebar(this.fileInfo),this.$emit("refresh")}catch(i){i.response&&i.response.data&&i.response.data.message?console.error(i.response.data):console.error(i)}},copyLinkTooltip(){return this.copied?this.copySuccess?"":o("permalink","Cannot copy, please copy the link manually"):o("permalink","Copy permalink to clipboard")},actionsTooltip(){return o("permalink","Actions for permalink")}}};var T=function(){var e=this,i=e._self._c;return i("li",{staticClass:"sharing-entry sharing-entry__link"},[i("div",{staticClass:"sharing-entry__summary"},[i("div",{staticClass:"sharing-entry__desc"},[i("p",[e._v(" "+e._s(e.permalink)+" ")])]),i("div",{staticClass:"sharing-entry__actions"},[i("NcActions",{ref:"copyButton",staticClass:"sharing-entry__copy"},[i("NcActionButton",{attrs:{"aria-label":e.copyLinkTooltip(),title:e.copyLinkTooltip(),href:e.permalink},on:{click:function(s){return s.preventDefault(),e.copyLink.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.copied&&e.copySuccess?i("CheckIcon",{staticClass:"icon-checkmark-color",attrs:{size:20}}):i("ClipboardIcon",{attrs:{size:20}})]},proxy:!0}])})],1)],1)]),i("NcActions",{staticClass:"sharing-entry__actions",attrs:{"aria-label":e.t("permalink","Actions for permalink"),"menu-align":"right"}},[i("NcActionButton",{on:{click:function(s){return s.preventDefault(),e.onDelete.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[i("CloseIcon",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("permalink","Delete permalink"))+" ")])],1)],1)},V=[],M=r(H,T,V,!1,null,"12b5e78f");const m=M.exports,R={components:{CreateButton:u,PermalinkVue:m},mixins:[f],props:{fileInfo:{type:Object,required:!0}},data(){return{activeButtonComponent:null,permalink:""}},mounted(){this.getPermalink(),this.refreshSidebar(this.fileInfo)},methods:{fullFilePath(){return this.fileInfo?this.fileInfo.path.endsWith("/")?this.fileInfo.path+this.fileInfo.name:this.fileInfo.path+"/"+this.fileInfo.name:""},async getPermalink(){const e=encodeURIComponent(this.fullFilePath());try{const i=await h.get(`/ocs/v2.php/apps/permalink/api/link?path=${e}`);console.log("Response:",i),i.data.ocs.data.permalink?(this.permalink=i.data.ocs.data.permalink,this.activeButtonComponent=m):(this.permalink=o("files_sharing","Create Permalink"),this.activeButtonComponent=u)}catch(i){i.response&&i.response.data&&i.response.data.message?console.error(i.response.data):console.error(i)}}}};var j=function(){var e=this,i=e._self._c;return i("div",[e.activeButtonComponent?i(e.activeButtonComponent,{tag:"component",attrs:{"file-info":e.fileInfo,permalink:e.permalink},on:{refresh:e.getPermalink}}):e._e()],1)},q=[],E=r(R,j,q,!1,null,"dccaaa25");const U=E.exports;c.prototype.OCA=window.OCA,c.mixin({methods:{t,n}});let a=null,l=null;const W=c.extend(U);window.addEventListener("DOMContentLoaded",function(){OCA.Sharing&&OCA.Sharing.ShareTabSections&&OCA.Sharing.ShareTabSections.registerSection((e,i)=>{!e||!i||(a&&document.contains(a.$el)&&l?l.fileInfo=i:(a&&a.$destroy(),a=new W({props:{fileInfo:i}}),l=c.observable({...a._props,fileInfo:i}),a._props=l,a.$mount(e[0])))})});
//# sourceMappingURL=permalink-main.mjs.map
